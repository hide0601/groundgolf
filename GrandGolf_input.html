<!DOCTYPE html>
<html>

<head>
  <?!= HtmlService.createHtmlOutputFromFile('css').getContent(); ?>
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP:400,700&display=swap&subset=japanese" rel="stylesheet">
</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>   
  <script src="https://cdn.jsdelivr.net/npm/@chenfengyuan/vue-number-input@1.2.1/dist/vue-number-input.min.js"></script>

  <!-- Vue -->
  <div class="block" id="app">
    <center>
      <h2 title="GAME No.<?=gameid ?>">大会名:<?=game_name ?>( <?=course_name ?>コース）</h2>
    </center>
  <template v-if="showAll">
    <center>
      <div class="title1" > Hole {{ hole }}</div>
    </center>
    <!--<div> -->
    <!-- オーソドックスな数字入力
      <label for="sr1"><?=player1 ?>：</label>
      <input type="text" v-model="sr1"number><br>
    -->
  
    <table id = "table05" align="center">
      <tbody>
        <tr>
          <td class = "length">
           コース長
          </td>
          <td>
            <number-input size="small" v-model="h_len" :min="10" :max="100" :step="5" inline center controls ></number-input><br>
          </td>
        </tr>
      </tbody>
    </table>
    <hr>
    <table id = "table05" align="center">
      <tbody>
        <tr>
          <td>
            <?=player1 ?>
          </td>
          <td>
            <number-input size="small" v-model="sr1" :min="1" :max="20" inline center controls ></number-input>
          </td>
        </tr>
        <tr>
          <td>
           <?=player2 ?>
          </td>
          <td>
            <number-input size="small" v-model="sr2" :min="1" :max="20" inline center controls ></number-input>
          </td>
        </tr>
        
        <template v-if="showP3">    
        <tr>
          <td>
            <?=player3 ?>
          </td>
          <td>
            <number-input size="small" v-model="sr3" :min="1" :max="20" inline center controls ></number-input><br>
          </td>
        </tr>
        </template>
        
        <template v-if="showP4">
        <tr>
          <td>
            <?=player4 ?>
          </td>
          <td>
            <number-input size="small" v-model="sr4" :min="1" :max="20" inline center controls ></number-input><br>
          </td>
        </tr>
        </template>
    
        <template v-if="showP5">
        <tr>
          <td>
            <?=player5 ?>
          </td>
          <td>
            <number-input size="small" v-model="sr5" :min="1" :max="20" inline center controls ></number-input><br>
          </td>
        </tr>
        </template>

        <template v-if="showP6">
        <tr>
          <td>
            <?=player6 ?>
          </td>
          <td>
            <number-input size="small" v-model="sr6" :min="1" :max="20" inline center controls ></number-input><br>
          </td>
        </tr>
        </template>
        
        <template v-if="showP7">
        <tr>
          <td>
            <?=player7 ?>
          </td>
          <td>
            <number-input size="small" v-model="sr7" :min="1" :max="20" inline center controls ></number-input><br>
          </td>
        </tr>
        </template>

        <template v-if="showP8">
        <tr>
          <td>
            <?=player8 ?>
          </td>
          <td>
            <number-input size="small" v-model="sr8" :min="1" :max="20" inline center controls ></number-input><br>
          </td>
        </tr>
        </template>
      </tbody>
    </table>

    <center>
    <button class="button3" @click="put_score(<?=gameid ?>,hole,h_len,sr1,sr2,sr3,sr4,sr5,sr6,sr7,sr8,<?=mem_amount?>);get_graff(<?=gameid ?>,'<?=com_ssId?>')" >データ更新</button>
    </center>
 
        <div class="chart-container" style="position: relative; width:100%; height:100%">
          <p><canvas id="myChart_total_stats"></canvas>
        </div>
  </template>
  <template v-if="showFin">
    <h4>Fin</h4>
  </template>
  <!-- vue -->
  </div>




<script>
var vm = new Vue({
  el: '#app',
    data: {
      hole:<?=starthole ?>,
      mem_amount:　null,
      h_len: '',
      sr1: '',
      sr2: '',
      sr3: '',
      sr4: '',
      sr5: '',
      sr6: '',
      sr7: '',
      sr8: '',
      showP3:true,
      showP4:true,
      showP5:true,
      showP6:true,
      showP7:true,
      showP8:true,
      showAll:true,
      showFin:false,
      ps_data:[],
  },
  methods: {
    put_score: function (sheetname,hole,h_len,sr1,sr2,sr3,sr4,sr5,sr6,sr7,sr8,men_amount) {
    console.log(sheetname,sr1);
    google.script.run
          .withSuccessHandler(function (data) {
          // GAS正常終了時の処理
            console.log('取得データ: ' + data);
            vm.hole=data;
            if(data == 0){
              vm.showAll = false;
              vm.showFin = true;
            }
          })
          .withFailureHandler(function (data) {
          // GASエラー時の処理
          })
　　　　　　.GG_PointInput(sheetname,hole,h_len,sr1,sr2,sr3,sr4,sr5,sr6,sr7,sr8,men_amount);
    },
    get_graff: async function(sheetname,ssId) {
      const ps_data_all = await this.getSheetData(sheetname,ssId);
      var ps_data = ps_data_all[0];
      console.log('pa_data ' + ps_data);
      this.ps_data = ps_data;     
      this.displayGraph_total(ps_data);
      this.sr1 = '';
      this.sr2 = '';
      this.sr3 = '';
      this.sr4 = '';
      this.sr5 = '';
      this.sr6 = '';
      this.sr7 = '';
      this.sr8 = '';

      },
      getSheetData: function(sheetname,ssId) {
        console.log('sheetname2: ' + sheetname);
        //コード.js内のgetSheetData()を実行
        return new Promise((resolve, reject) => {
          google.script.run
            .withSuccessHandler((result) => resolve(result))
            .withFailureHandler((error) => resolve(error))
            .GG_point_stats(sheetname,ssId);
        });
      },    
      displayGraph_total: function(){
      var ctx = document.getElementById('myChart_total_stats').getContext('2d');
      var myChart_total_stats = new Chart(ctx, {
        type: "bar",
        data:{
         labels:[<?=player1 ?>,<?=player2 ?>,<?=player3 ?>,<?=player4 ?>,<?=player5 ?>],
         datasets:[{
         label: 'TotalScore',
         data:this.ps_data
         }]
       },
     options:{    
/*     title: {
       display: true,
       fontSize: 12,
       text: 'TotalScore'
       },
*/ 
     },
     });
    },
},//method終わり

//★できていない
mounted:function(){
  var showP3 = "";
  var showP4 = "";
  var showP5 = "";
  var showP6 = "";
  var showP7 = "";
  var showP8 = "";

  if(<?=mem_amount?> == "2"){
    this.showP3 = false;
    this.showP4 = false;
    this.showP5 = false;
    this.showP6 = false;
    this.showP7 = false;
    this.showP8 = false;
  }
  else if(<?=mem_amount?> == "3"){
    this.showP4 = false;
    this.showP5 = false;
    this.showP6 = false;
    this.showP7 = false;
    this.showP8 = false;
  }
  else if(<?=mem_amount?> == "4"){
    this.showP5 = false;
    this.showP6 = false;
    this.showP7 = false;
    this.showP8 = false;
  }  
  else if(<?=mem_amount?> == "5"){
    this.showP6 = false;
    this.showP7 = false;
    this.showP8 = false;
  }  
  else if(<?=mem_amount?> == "6"){
    this.showP7 = false;
    this.showP8 = false;
  }  
  else if(<?=mem_amount?> == "7"){
    this.showP8 = false;
  }
},//moutedの終わり



})//vueの終わり



</script>

</body>
</html>
